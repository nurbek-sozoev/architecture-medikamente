# Задание 3. Оценка Data Encryption at Rest and In Transit

## Классификация данных

### Классификация по состоянию данных

| Состояние                               | Описание                                                                                     | Примеры в системе "Медикаменте"                                                                                                                   |
| --------------------------------------- | -------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Data at Rest** (данные в покое)       | Данные, хранящиеся на постоянных носителях: базы данных, файловые хранилища, резервные копии | Медицинские карты в PostgreSQL, сканы паспортов в S3, базы 1С, резервные копии на дисках                                                          |
| **Data in Transit** (данные в передаче) | Данные, передаваемые по сети между компонентами системы или во внешние системы               | Запросы от клиентов через Kong API Gateway, обмен данными между сервисами через Apache NiFi, отправка отчетности в ФНС, интеграция с лабораторией |
| **Data in Use** (данные в обработке)    | Данные, находящиеся в оперативной памяти и обрабатываемые приложениями                       | Расшифрованные медицинские записи в памяти приложения во время приема врача, данные в кеше сессии                                                 |

### Классификация по уровню чувствительности

| Уровень                    | Описание                                                                                                      | Примеры данных                                                                                                             |
| -------------------------- | ------------------------------------------------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------- |
| **Особо конфиденциальные** | Данные, утечка которых наносит критический ущерб субъекту и влечет уголовную/административную ответственность | Диагнозы, назначения, рецепты, результаты анализов, скан паспорта, ИНН/СНИЛС сотрудников, зарплаты, данные банковских карт |
| **Конфиденциальные**       | Персональные и финансовые данные, утечка которых наносит значительный ущерб                                   | ФИО пациентов, дата рождения, телефон, email, адрес, наименование медицинской услуги в платежах, данные о платежах         |
| **Внутренние**             | Данные для служебного пользования, не содержащие ПДн                                                          | Данные поставщиков, стоимость закупок, накладные, наименования ТМЦ, внутренняя переписка без ПДн                           |
| **Публичные**              | Общедоступная информация                                                                                      | Расписание работы клиники, перечень услуг, контакты клиники                                                                |

### Классификация по профилю риска

| Профиль риска   | Описание                                  | Данные                                                        | Последствия утечки                                                        |
| --------------- | ----------------------------------------- | ------------------------------------------------------------- | ------------------------------------------------------------------------- |
| **Критический** | Медицинская тайна, идентификация личности | Связка "ФИО/диагноз", "ФИО/результат анализа"                 | Нарушение врачебной тайны, уголовная ответственность, репутационный ущерб |
| **Высокий**     | Персональные данные, финансы              | ФИО, паспортные данные, ИНН, данные банковских карт, зарплаты | Нарушение 152-ФЗ                                                          |
| **Средний**     | Бизнес-данные ограниченного доступа       | Данные поставщиков, закупочные цены, финансовая отчетность    | Конкурентный ущерб, финансовые потери                                     |
| **Низкий**      | Общие операционные данные                 | Расписание, перечень услуг                                    | Минимальный ущерб                                                         |

## Обоснование необходимости защиты и инструменты

### Реестр данных с обоснованием и инструментами защиты

| Данные                                                       | В чем необходимость защиты                                                                                                                    | Инструменты защиты                                                                                                                                                                               |
| ------------------------------------------------------------ | --------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| **Диагнозы, назначения, рецепты**                            | Врачебная тайна по закону (ст. 13 ФЗ-323). Утечка раскрывает здоровье пациента - риск шантажа и дискриминации. Штрафы до 500 тыс. руб.        | **При хранении:** шифрование отдельных полей в PostgreSQL (pgcrypto, AES-256), ключи в HashiCorp Vault. **При передаче:** TLS 1.3 между сервисами, взаимная аутентификация через Kong            |
| **Результаты анализов**                                      | Медицинская тайна. Передаются между лабораторией и клиникой - высокий риск перехвата. Напрямую связывают пациента с заболеванием              | **При хранении:** шифрование файлов в S3 (AES-256), электронная подпись лаборатории. **При передаче:** взаимная аутентификация при обмене с лабораторией через Apache NiFi                       |
| **Сканы паспортов**                                          | Полный набор данных для идентификации личности. При утечке можно оформить кредит или зарегистрировать фирму на чужое имя                      | **При хранении:** шифрование в S3 (AES-256), доступ только через временные ссылки (действуют 5 минут). **При передаче:** TLS 1.3                                                                 |
| **ФИО, дата рождения, контакты пациентов**                   | Персональные данные, защита обязательна по 152-ФЗ. Утечка позволяет идентифицировать пациента и связать с его медицинскими записями           | **При хранении:** прозрачное шифрование табличных пространств PostgreSQL. **При передаче:** TLS 1.3 для клиентских соединений через Kong                                                         |
| **Данные банковских карт**                                   | По стандарту PCI DSS клиника не должна хранить номера карт. Утечка приводит к прямым финансовым потерям пациентов                             | **При хранении:** токенизация через платежный шлюз - реальные номера карт в системе не хранятся. **При передаче:** TLS 1.3 и сквозное шифрование от терминала до платежного шлюза                |
| **ИНН, СНИЛС сотрудников**                                   | Уникальные идентификаторы. При утечке возможно налоговое мошенничество и оформление документов на чужое имя                                   | **При хранении:** шифрование полей в 1С и PostgreSQL (AES-256), ключи в HashiCorp Vault. **При передаче:** TLS 1.3                                                                               |
| **Зарплаты сотрудников**                                     | Конфиденциальная информация. Разглашение нарушает трудовое законодательство и может вызвать конфликты в коллективе                            | **При хранении:** шифрование полей в 1С (AES-256), доступ только у бухгалтера и руководителя. **При передаче:** TLS 1.3 при отправке ведомостей в банк                                           |
| **Электронная почта с персональными и медицинскими данными** | Раньше сотрудники пересылали данные пациентов по почте без шифрования. Почтовый трафик легко перехватить                                      | **При хранении:** шифрование писем на почтовом сервере (S/MIME). **При передаче:** обязательное шифрование почтового трафика, система предотвращения утечек блокирует отправку на внешние адреса |
| **Согласия на обработку персональных данных**                | Юридическое основание для работы с данными по 152-ФЗ. Без подтвержденного согласия обработка незаконна. Нужно хранить с гарантией целостности | **При хранении:** PostgreSQL с электронной подписью каждой записи и прозрачным шифрованием. **При передаче:** TLS 1.3                                                                            |
| **Журналы аудита**                                           | Нужны для расследования инцидентов и подтверждения соответствия закону. Должны быть защищены от подделки и удаления                           | **При хранении:** хранилище только на запись в ELK Stack, подпись каждой записи, шифрование индексов. **При передаче:** TLS 1.3                                                                  |
| **Данные о закупках и поставщиках**                          | Коммерческая тайна. Утечка закупочных цен дает конкурентам преимущество                                                                       | **При хранении:** прозрачное шифрование PostgreSQL и базы 1С. **При передаче:** TLS 1.3 при обмене с поставщиками                                                                                |
| **Налоговая отчетность**                                     | Содержит финансовые данные компании и персональные данные сотрудников. Требует защиты при передаче в налоговую                                | **При хранении:** шифрование в 1С. **При передаче:** квалифицированная электронная подпись и зашифрованный канал при отправке в ФНС                                                              |
| **Резервные копии**                                          | Полный слепок всех данных системы. Самая ценная цель для злоумышленника - одна копия раскрывает все                                           | **При хранении:** шифрование перед записью (AES-256), ключи хранятся отдельно в HashiCorp Vault. Копии распределены по разным площадкам                                                          |

## Базовые инструменты защиты

### Шифрование данных при хранении

| Что используем                          | Зачем                                                                                         | Где                    |
| --------------------------------------- | --------------------------------------------------------------------------------------------- | ---------------------- |
| **PostgreSQL + pgcrypto**               | Шифруем отдельные чувствительные поля — диагнозы, назначения, ИНН, СНИЛС                      | Основная БД клиники    |
| **PostgreSQL TDE**                      | Прозрачное шифрование всей базы целиком — персональные данные пациентов, платежная информация | Основная БД клиники    |
| **S3 с шифрованием на стороне сервера** | Шифрование файлов при загрузке — сканы паспортов, результаты анализов, мед. документы         | Объектное хранилище    |
| **HashiCorp Vault**                     | Управление ключами шифрования, их ротация и аудит доступа                                     | Все компоненты системы |
| **1С (клиент-серверный режим)**         | Шифрование базы 1С средствами PostgreSQL                                                      | Бухгалтерия, склад     |
| **LUKS / BitLocker**                    | Полнодисковое шифрование серверов и рабочих станций                                           | Все серверы и ПК       |
| **Шифрование бэкапов (GPG)**            | Шифруем резервные копии перед выгрузкой на внешние носители                                   | Система бэкапов        |

### Шифрование данных при передаче

| Что используем          | Зачем                                                                 | Где                                           |
| ----------------------- | --------------------------------------------------------------------- | --------------------------------------------- |
| **TLS 1.3**             | Шифрование соединений с клиентами — браузер, мобильное приложение     | API Gateway -> клиенты                        |
| **mTLS**                | Взаимная аутентификация между внутренними сервисами                   | Межсервисные вызовы внутри системы            |
| **NiFi (Site-to-Site)** | Шифрованная передача данных с лабораторией и между внутренними узлами | Интеграция с лабораторией                     |
| **S/MIME**              | Шифрование и подпись электронных писем                                | Почтовый сервер                               |
| **STARTTLS**            | Шифрование почтового трафика при отправке наружу                      | Почта -> внешние серверы                      |
| **P2PE**                | Шифрование данных карты от терминала до платежного шлюза              | Кассовый терминал -> платежный шлюз           |
| **VPN (WireGuard)**     | Шифрованный туннель для удаленного доступа сотрудников                | Удаленные рабочие места -> корпоративная сеть |
| **КЭП**                 | Подпись и шифрование налоговой отчетности для ФНС                     | 1С -> ФНС                                     |

## Автоматизированный контроль

### Средства мониторинга и контроля

| Инструмент                                        | Что контролирует                                                                                                   | Как работает                                                                                                                                                                         |
| ------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------ | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| **ELK Stack (Elasticsearch + Logstash + Kibana)** | Все обращения к данным: кто, когда, к каким записям обращался, какие операции выполнял                             | Logstash собирает логи со всех сервисов -> Elasticsearch индексирует -> Kibana визуализирует. Настроены алерты на аномальную активность (массовый экспорт, доступ в нерабочее время) |
| **HashiCorp Vault Audit Log**                     | Все операции с ключами шифрования: создание, использование, ротация, удаление                                      | Vault ведет неизменяемый журнал каждого обращения к ключам. Алерт при попытке доступа к ключам неавторизованным сервисом                                                             |
| **Apache Atlas**                                  | Местонахождение данных, метки чувствительности, перемещение данных между системами (Data Lineage)                  | Автоматически обновляет каталог данных, отслеживает, где хранятся данные с тегами L3/L4, как они перемещаются                                                                        |
| **Apache Ranger**                                 | Соблюдение политик доступа: кто имеет доступ к каким данным на основании тегов                                     | Автоматически применяет политики (например, "данные patient:phi:L4 доступны только лечащему врачу"). Блокирует и логирует нарушения                                                  |
| **DLP-система (Data Loss Prevention)**            | Утечки данных через почту, USB, облачные хранилища                                                                 | Сканирует исходящие письма и файлы на наличие ПДн и мед. данных. Блокирует отправку и создает инцидент                                                                               |
| **Сканер уязвимостей**                            | Уязвимости в конфигурации TLS, устаревшие сертификаты, слабые алгоритмы шифрования                                 | Еженедельное автоматическое сканирование всех эндпоинтов. Отчет об истекших сертификатах, использовании TLS < 1.2, слабых cipher suites                                              |
| **Certificate Manager**                           | Жизненный цикл TLS-сертификатов: выпуск, продление, отзыв                                                          | Автоматический выпуск и ротация сертификатов через Let's Encrypt или внутренний CA. Алерт за 30 дней до истечения                                                                    |
| **Nagios / Zabbix**                               | Состояние инфраструктуры шифрования: доступность Vault, статус шифрования дисков, работоспособность TLS-терминации | Непрерывный мониторинг с алертами при деградации сервисов шифрования                                                                                                                 |

## Реестр программных и аппаратных средств защиты данных

### Программные средства

| Средство                | Категория                | Назначение в контексте шифрования                                                                                                                 | Лицензия     |
| ----------------------- | ------------------------ | ------------------------------------------------------------------------------------------------------------------------------------------------- | ------------ |
| **HashiCorp Vault**     | Управление ключами       | Централизованное хранение и ротация ключей шифрования для всех компонентов системы, ведение аудита доступа к секретам                             | Open Source  |
| **PostgreSQL/pgcrypto** | База данных              | Шифрование отдельных столбцов с чувствительными данными (диагнозы, персональные идентификаторы), а также шифрование табличных пространств целиком | Open Source  |
| **MinIO**               | Объектное хранилище      | Шифрование файлов (сканы, результаты анализов) на стороне сервера с использованием ключей из Vault                                                | Open Source  |
| **Apache NiFi**         | Интеграция данных        | Защита данных при передаче между системами по зашифрованным каналам, обезличивание перед отправкой в аналитику                                    | Open Source  |
| **Kong**                | API-шлюз                 | Защита входящего трафика через шифрованные соединения, взаимная аутентификация сервисов, контроль доступа к API                                   | Open Source  |
| **ELK Stack**           | Мониторинг и аудит       | Шифрование хранимых логов и защита каналов передачи данных между компонентами стека                                                               | Open Source  |
| **DLP-система**         | Предотвращение утечек    | Контроль за тем, чтобы данные не уходили в незашифрованном виде через почту или съемные носители                                                  | Коммерческая |
| **OpenVAS**             | Сканер уязвимостей       | Проверка настроек шифрования, поиск устаревших или небезопасных алгоритмов                                                                        | Open Source  |
| **cert-manager**        | Управление сертификатами | Автоматический выпуск и обновление сертификатов для защищенных соединений                                                                         | Open Source  |
| **WireGuard**           | VPN                      | Шифрование удаленного доступа сотрудников к корпоративной сети                                                                                    | Open Source  |
| **GnuPG**               | Шифрование файлов        | Шифрование резервных копий перед их сохранением на внешние носители                                                                               | Open Source  |

### 5.2. Аппаратные средства

| Средство                                        | Категория                      | Назначение                                                                                                     | Применение                                       |
| ----------------------------------------------- | ------------------------------ | -------------------------------------------------------------------------------------------------------------- | ------------------------------------------------ |
| **HSM-модуль**                                  | Аппаратный модуль безопасности | Генерация и хранение главных ключей шифрования в специальном устройстве, из которого невозможно их извлечь     | Мастер-ключ для Vault, ключи электронной подписи |
| **TPM-чип**                                     | Доверенный модуль платформы    | Хранение ключей для полнодискового шифрования, контроль целостности системы при загрузке                       | Все серверы и рабочие станции                    |
| **Платежный терминал с аппаратным шифрованием** | Платежное оборудование         | Шифрование данных банковской карты прямо на устройстве, начиная с момента считывания                           | Касса клиники                                    |
| **Аппаратный межсетевой экран**                 | Сетевой файрвол                | Проверка зашифрованного трафика, блокировка незащищенных соединений, обнаружение вторжений                     | Периметр сети клиники                            |
| **Самошифрующие диски**                         | Накопители                     | Аппаратное шифрование данных на дисках серверов — дополнительный уровень защиты помимо программного шифрования | Серверы баз данных, файловый сервер              |
